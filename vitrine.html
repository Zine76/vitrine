<!DOCTYPE html>

<html lang="fr">
<head>
<style>
/* Minimal early CSS to prevent landing flash when locked */
.is-room-locked #landing,
.is-room-locked .landing,
.is-room-locked [data-route="landing"],
.is-room-locked [data-component*="landing"],
.is-room-locked [class*="landing"],
.is-room-locked [id*="landing"] { display:none !important; }
.is-room-locked .change-room-btn,
.is-room-locked [data-action="choose-room"],
.is-room-locked [data-action="change-room"],
.is-room-locked [onclick*="changeRoom"],
.is-room-locked [href*="landing"] {
  pointer-events:none !important; opacity:.5 !important; filter:grayscale(1);
}
</style>
<script>
(function(){
  // <<< RENSEIGNE ICI TON BACKEND DEV >>> 
  var DEV_BASE  = 'http://localhost:7070';  // ex: http://127.0.0.1:8080
  var PROD_BASE = 'http://132.208.182.75:7070'; // m√™me domaine en prod
  var FORCE     = (location.protocol === 'file:');

  var BASE = FORCE ? DEV_BASE : PROD_BASE;

  function isHttp(u){ return /^https?:\/\//i.test(u); }
  function join(base, path){ return base.replace(/\/+$/,'') + '/' + String(path||'').replace(/^\/+/, ''); }

  function looksLikeApi(u){
    if (!u) return false;
    // enlever file:///C:.../ pour inspecter
    var raw = String(u).replace(/^file:[^?]*/i, '');
    // enlever './' '../' et '/' de t√™te
    raw = raw.replace(/^[.\/]+/, '');
    // heuristique large: contient "/api" en d√©but OU apr√®s base file
    return (/^(api|podio|backend)/i.test(raw) || /(^|\/)api(\/|$)/i.test(raw));
  }

  function absolutize(input, init){
    try {
      if (!FORCE) return { input, init };
      if (typeof input === 'string') {
        // si d√©j√† http -> untouched
        if (isHttp(input)) return { input, init };
        if (looksLikeApi(input)) return { input: join(BASE, input), init };
        // cas "null/..." construit ailleurs
        if (/^null\//i.test(input)) return { input: join(BASE, input.replace(/^null\//i,'')), init };
      }
      // Request object
      if (input && input.url) {
        var url = input.url;
        if (!isHttp(url)) {
          if (looksLikeApi(url) || /^file:/i.test(url) || /^null/i.test(url)) {
            var norm = url.replace(/^file:[^?]*/i,'').replace(/^null\//i,'');
            var newUrl = join(BASE, norm);
            // reconstruire en conservant toutes les options
            var opts = {
              method: input.method,
              headers: input.headers,
              body: input.body,
              mode: input.mode,
              credentials: input.credentials,
              cache: input.cache,
              redirect: input.redirect,
              referrer: input.referrer,
              referrerPolicy: input.referrerPolicy,
              integrity: input.integrity,
              keepalive: input.keepalive,
              signal: input.signal,
              duplex: input.duplex
            };
            input = new Request(newUrl, opts);
          }
        }
      }
    } catch(e){ console.warn('[API PATCH v6]', e); }
    return { input, init };
  }

  // fetch
  var _fetch = window.fetch;
  window.fetch = function(input, init){
    var r = absolutize(input, init);
    return _fetch(r.input, r.init);
  };

  // XHR
  var _open = XMLHttpRequest.prototype.open;
  XMLHttpRequest.prototype.open = function(method, url){
    try {
      if (!isHttp(url) && looksLikeApi(url)) url = join(BASE, url);
      if (/^file:/i.test(url)) url = join(BASE, url.replace(/^file:[^?]*/i,''));
      if (/^null\//i.test(url)) url = join(BASE, url.replace(/^null\//i,''));
    } catch(e){}
    return _open.apply(this, [method, url].concat([].slice.call(arguments, 2)));
  };

  // Expose pour debug
  window.__API_BASE__ = BASE;
  if (FORCE) console.log('[API PATCH v6] BASE =', BASE);
})();
</script>

<link rel="stylesheet" href="https://zine76.github.io/vitrine/styles.css?v=1755648765">
<script src="https://zine76.github.io/vitrine/app.js?v=1755648765" defer></script>

<!-- VITRINE LOCK EARLY (prevents F5 landing) -->



<!-- API BASE PATCH v6: ultra-robuste (file://, '/api', 'api/', URLs file/null, Request & XHR) -->


<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Vitrine</title>
<!-- Favicon -->
<link href="https://zine76.github.io/vitrine/assets/Vitrine.png?v=1755648765" rel="icon" type="image/png"/>
<!-- Font Awesome pour les ic√¥nes -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
</head>
<body>
<!-- Container principal -->
<div class="main-container">
<!-- Header -->
<div class="header">
<div class="header-top">
<button class="technical-btn" onclick="openTechnicalMode()">
<i class="fas fa-cog"></i>
<span>Technique</span>
</button>
<button aria-label="Basculer le mode sombre" class="theme-toggle" onclick="toggleTheme()">
<i class="fas fa-moon" id="themeIcon"></i>
<span id="themeText">Mode nuit</span>
</button>
</div>
<div class="title-section" style="display: flex; align-items: center; justify-content: flex-start; gap: 2rem;">
<img alt="Vitrine" src="https://zine76.github.io/vitrine/assets/Vitrine.png?v=1755648765" style="height: 80px; max-width: 300px; object-fit: contain;"/>
<p id="headerTitle" style="margin: 0; font-size: 1.1rem; font-weight: 600; color: black !important; -webkit-text-fill-color: black !important;">Diagnostic interactif et assistance audiovisuelle</p>
</div>
<div class="status-indicator">
<div class="status-dot"></div>
<span>Syst√®me op√©rationnel</span>
</div>
</div>
<!-- Landing Page - Saisie de salle obligatoire -->
<div class="landing-page" id="landingPage">
<div class="landing-content">
<div class="room-input-banner">
<div class="banner-header">
<span class="banner-icon">üìç</span>
<h3>Quelle salle avez-vous besoin d'aide ?</h3>
</div>
<div class="banner-content">
<p>Entrez le num√©ro de votre salle pour acc√©der √† l'assistant personnalis√©</p>
<div class="room-input-container">
<input class="room-input" id="roomInput" onkeypress="handleRoomKeyPress(event)" placeholder="Ex: A-1750, B-2500, SH-R200..." type="text"/>
<button class="confirm-room-btn" id="confirmRoomBtn" onclick="confirmRoom()">
                                ‚úÖ Confirmer
                            </button>
</div>
<div class="room-examples">
<p><strong>Exemples de formats accept√©s :</strong></p>
<div class="example-rooms">
<span class="room-example" onclick="setRoomExample('A-1750')">A-1750</span>
<span class="room-example" onclick="setRoomExample('B-2500')">B-2500</span>
<span class="room-example" onclick="setRoomExample('J-2430')">J-2430</span>
<span class="room-example" onclick="setRoomExample('SH-R200')">SH-R200</span>
<span class="room-example" onclick="setRoomExample('DS-4000')">DS-4000</span>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Assistant Page - Affich√© apr√®s validation de la salle -->
<div class="content" id="assistantPage" style="display: none;">
<!-- Header de salle -->
<div class="room-header" id="roomHeader">
<div class="current-room-info">
<span class="room-icon">üìç</span>
<span class="room-text">Salle : <strong id="currentRoomDisplay">-</strong></span>
<button class="change-room-btn" onclick="changeRoom()" title="Changer de salle">
<i class="fas fa-edit"></i>
</button>
</div>
<!-- ‚úÖ SUPPRIM√â : Boutons inutiles Mode nuit et Accueil dans la zone de salle -->
</div>
<!-- Champ de saisie cach√© pour les messages -->
<input id="problemInput" style="display: none;" type="text"/>
<!-- Section des palettes de probl√®mes -->
<div class="problem-palettes" id="problemPalettes">
<!-- Palette Audio -->
<div class="palette audio" onclick="sendExampleMessage('Pas de son')">
<div class="palette-icon">üîµ</div>
<h3>Probl√®me Audio</h3>
<p>Microphones, haut-parleurs, volume, qualit√© sonore</p>
</div>
<!-- Palette Vid√©o -->
<div class="palette video" onclick="sendExampleMessage('√âcran noir projecteur')">
<div class="palette-icon">üü£</div>
<h3>Probl√®me Vid√©o</h3>
<p>Projecteurs, √©crans, qualit√© d'image, connectivit√©</p>
</div>
<!-- Palette R√©seau -->
<div class="palette network" onclick="sendExampleMessage('Probl√®me de r√©seau')">
<div class="palette-icon">üü†</div>
<h3>Probl√®me R√©seau</h3>
<p>Connexion internet, Wi-Fi, connectivit√© r√©seau</p>
</div>
<!-- Palette Autres -->
<div class="palette other" onclick="sendExampleMessage('Syst√®me qui ne r√©pond plus')">
<div class="palette-icon">üü¢</div>
<h3>Autres Probl√®mes</h3>
<p>√âquipements, infrastructure, maintenance g√©n√©rale</p>
</div>
</div>
<!-- Section des suggestions -->
<div class="suggestions" id="suggestions"></div>
</div>
</div>
<!-- Modale de r√©sultat -->
<div class="modal-overlay" id="modalOverlay">
<div class="modal" id="modal">
<div class="modal-icon" id="modalIcon">‚úÖ</div>
<h3 id="modalTitle">Probl√®me r√©solu</h3>
<p id="modalMessage">Le probl√®me a √©t√© corrig√© automatiquement.</p>
<button class="modal-btn" onclick="closeModal()">Retour √† l'accueil</button>
</div>
</div>

<!-- Chat SEA Modal -->
<div class="chat-modal" id="chatModal">
<div class="chat-container">
<div class="chat-header">
<h3>üí¨ Chat SEA - Assistance en direct</h3>
<button class="chat-close" onclick="closeChat()">
<i class="fas fa-times"></i>
</button>
</div>
<div class="chat-content" id="chatContent">
<div class="chat-messages" id="chatMessages"></div>
<div class="chat-input-area">
<input type="text" id="chatInput" placeholder="Tapez votre message..." onkeypress="handleChatKeyPress(event)">
<button onclick="sendChatMessage()" class="send-btn">
<i class="fas fa-paper-plane"></i>
</button>
</div>
</div>
</div>
</div>

<!-- Consent Banner Centr√©e avec Animation Sonnerie -->
<div class="consent-banner" id="consentBanner" style="display: none;">
    <div class="consent-content">
        <!-- Ic√¥ne chat qui clignote comme une notification -->
        <div class="consent-banner-phone">
            <i class="fas fa-comments fa-3x"></i>
        </div>
        
        <div class="consent-text">
            <h4>üí¨ Demande de chat SEA</h4>
            <p>Le service SEA souhaite √©tablir un chat pour assister avec le ticket <strong id="consentTicketNumber">-</strong></p>
            <p><em>Demande de chat pour salle <span id="consentRoomName">-</span></em></p>
        </div>
        
        <div class="consent-actions">
            <button class="consent-btn accept" onclick="acceptChat()">
                <i class="fas fa-check"></i>
                Accepter
            </button>
            <button class="consent-btn decline" onclick="declineChat()">
                <i class="fas fa-times"></i>
                Refuser
            </button>
        </div>
    </div>
</div>

<!-- Chat Timeout Banner -->
<div class="chat-timeout-banner" id="chatTimeoutBanner" style="display: none;">
    <h3>
        <i class="fas fa-clock"></i>
        Demande de chat expir√©e
    </h3>
    <p>Le technicien SEA √©tait disponible pour discuter de votre probl√®me, mais le d√©lai de r√©ponse a expir√©.</p>
    <p><strong>Souhaitez-vous initier une conversation avec le technicien ?</strong></p>
    
    <div class="timeout-actions">
        <button class="timeout-btn initiate" onclick="initiateClientChat()">
            <i class="fas fa-comments"></i>
            Contacter le SEA
        </button>
        <button class="timeout-btn close" onclick="closeTimeoutBanner()">
            <i class="fas fa-times"></i>
            Fermer
        </button>
    </div>
</div>


<!-- Fonction globale supprim√©e - utilisation de createTicketDirect -->



<!-- VITRINE LOCK ENFORCER -->


<!-- ‚úÖ NOUVEAU : Overlay de chargement diagnostic -->
<div id="diagnosticLoadingOverlay" class="diagnostic-loading-overlay">
    <div class="diagnostic-loading-content">
        <div class="diagnostic-hourglass">
            <i class="fas fa-hourglass-half"></i>
        </div>
        <div class="diagnostic-loading-text">Diagnostic en cours...</div>
        <p class="diagnostic-loading-subtext">V√©rification automatique du syst√®me</p>
    </div>
</div>

<!-- ‚úÖ NOUVEAU : Modal d'authentification technique -->
<div id="technicalAuthModal" class="technical-auth-modal">
    <div class="technical-auth-content">
        <h3>
            <i class="fas fa-lock"></i>
            Acc√®s Technique
        </h3>
        <p style="color: #64748b; margin-bottom: 1.5rem;">Veuillez saisir le mot de passe technique pour acc√©der au mode avanc√©.</p>
        <input 
            type="password" 
            id="technicalPassword" 
            class="technical-password-input" 
            placeholder="Mot de passe technique"
            onkeypress="handleTechnicalPasswordKeypress(event)"
        />
        <div class="technical-auth-error" id="technicalAuthError">
            Mot de passe incorrect. Veuillez r√©essayer.
        </div>
        <div class="technical-auth-buttons">
            <button class="technical-auth-btn technical-auth-cancel" onclick="closeTechnicalAuth()">
                Annuler
            </button>
            <button class="technical-auth-btn technical-auth-submit" onclick="submitTechnicalAuth()">
                <i class="fas fa-unlock"></i>
                Acc√©der
            </button>
        </div>
    </div>
</div>

<!-- ‚úÖ NOUVEAU : Page technique -->
<div id="technicalPage" class="technical-page">
    <div class="technical-header">
        <div class="technical-title">
            <i class="fas fa-cog"></i>
            <h2>Mode Technique</h2>
        </div>
        <button class="technical-return-btn" onclick="returnToVitrine()">
            <i class="fas fa-arrow-left"></i>
            Retour √† Vitrine
        </button>
    </div>
    <div class="technical-content">
        <div class="technical-construction-banner">
            <h3>
                <i class="fas fa-hard-hat"></i>
                Page en Construction
            </h3>
            <p>Cette section technique est actuellement en d√©veloppement. Les plans unifilaires et autres outils techniques seront bient√¥t disponibles.</p>
        </div>
        
        <!-- Section future pour les plans unifilaires -->
        <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 2rem;">
            <h4 style="color: #1e293b; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-blueprint"></i>
                Plans Unifilaires
            </h4>
            <p style="color: #64748b; margin: 0;">
                <strong>Salle actuelle :</strong> <span id="technicalCurrentRoom">-</span><br>
                <em>Le plan unifilaire pour cette salle sera affich√© ici prochainement.</em>
            </p>
        </div>

        <!-- Section future pour autres outils -->
        <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
            <h4 style="color: #1e293b; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-tools"></i>
                Outils Techniques
            </h4>
            <p style="color: #64748b; margin: 0;">
                <em>Diagnostic avanc√©, gestion r√©seau, et autres outils techniques seront disponibles ici.</em>
            </p>
        </div>
    </div>
</div>

</body>
</html> 
